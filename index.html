<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title> SSKH Drug Interaction Checker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root {
      --bg: #0b1020;
      --card: #121833;
      --muted: #aab2d5;
      --border: #2a3463;
      --ok: #1f8b4c;
      --warn: #d4a106;
      --danger: #c93939;
      --accent: #7aa2ff;
      --text: #e8ecff;
      --hover: rgba(122,162,255,0.08);
    }
    :root.light {
      --bg: #f5f7ff;
      --card: #ffffff;
      --muted: #4a4a4a;
      --border: #d6d9e6;
      --ok: #1f8b4c;
      --warn: #b88405;
      --danger: #b53333;
      --accent: #3355cc;
      --text: #1a1a1a;
      --hover: rgba(51,85,204,0.06);
    }
    * { box-sizing: border-box; }
    body {
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 24px;
      color: var(--text);
      background: var(--bg);
      transition: background 0.3s, color 0.3s;
    }
    h1, h2, h3 { margin: 0 0 10px; }
    .sub { color: var(--muted); font-size: 0.95rem; margin-bottom: 18px; }
    .row { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
    }
    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 980px) { .grid { grid-template-columns: 420px 1fr; } }

    label { font-size: 0.85rem; color: var(--muted); }
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s, border-color 0.3s;
    }
    textarea { resize: vertical; min-height: 56px; }
    .btn {
      appearance: none;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform .05s ease, background .2s ease, border-color .2s ease, color .2s ease;
    }
    .btn:hover { background: var(--accent); color: #fff; }
    .btn:active { transform: translateY(1px); }
    .btn.secondary { background: transparent; }
    .btn.ghost { background: transparent; }

    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px dashed var(--border); padding: 10px; text-align: left; }
    th { color: var(--text); font-weight: 600; position: sticky; top: 0; background: var(--card); }
    tr:hover td { background: var(--hover); }

    .pill { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; font-weight: 600; font-size: 0.85rem; }
    .pill.low { background: rgba(31,139,76,.12); color: var(--ok); border: 1px solid rgba(31,139,76,.4); }
    .pill.mid { background: rgba(212,161,6,.12); color: var(--warn); border: 1px solid rgba(212,161,6,.45); }
    .pill.high { background: rgba(201,57,57,.12); color: var(--danger); border: 1px solid rgba(201,57,57,.45); }

    .toolbar { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .muted { color: var(--muted); font-size: 0.9rem; }
    .right { margin-left: auto; }
    .nowrap { white-space: nowrap; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
    .danger { color: var(--danger); }
  </style>
</head>
<body>
  <header style="margin-bottom:20px; display:flex; align-items:center; gap:12px;">
    <div>
      <h1>Drug Interaction Checker</h1>
      <div class="sub">‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏π‡πà‡∏¢‡∏≤‡∏ã‡πâ‡∏≥‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢: ‡πÄ‡∏£‡∏≤‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö <em>‡∏Ñ‡∏π‡πà‡∏¢‡∏≤</em> ‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏°‡∏≤‡∏ï‡∏£ (A+B = B+A) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏µ‡∏ö‡πà‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ñ‡∏∏‡∏ì</div>
    </div>
    <button class="btn right" id="btnTheme" title="‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°">üåô ‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î</button>
  </header>

  <div class="grid">
    <section class="card">
      <h2 style="margin-bottom:10px">‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏Ñ‡∏π‡πà‡∏¢‡∏≤</h2>
      <div class="row">
        <div style="flex:1; min-width: 180px;">
          <label for="drugA">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤ 1</label>
          <input id="drugA" list="drugList" placeholder="‡πÄ‡∏ä‡πà‡∏ô Aspirin" />
        </div>
        <div style="flex:1; min-width: 180px;">
          <label for="drugB">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤ 2</label>
          <input id="drugB" list="drugList" placeholder="‡πÄ‡∏ä‡πà‡∏ô Warfarin" />
        </div>
      </div>
      <div class="row">
        <div style="flex:1; min-width: 180px;">
          <label for="severity">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</label>
          <select id="severity">
            <option value="‡∏™‡∏π‡∏á">‡∏™‡∏π‡∏á (‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á/‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î)</option>
            <option value="‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏£‡∏∞‡∏ß‡∏±‡∏á/‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤)</option>
            <option value="‡∏ï‡πà‡∏≥">‡∏ï‡πà‡∏≥ (‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£)</option>
          </select>
        </div>
        <div style="flex:2; min-width: 240px;">
          <label for="notes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <input id="notes" placeholder="‡∏Å‡∏•‡πÑ‡∏Å, ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£, ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠" />
        </div>
      </div>
      <div class="toolbar" style="margin-top:10px">
        <button class="btn" id="btnAdd">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</button>
        <button class="btn secondary" id="btnCheck">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
        <div class="right muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (localStorage)</div>
      </div>
      <datalist id="drugList"></datalist>
    </section>

    <section class="card">
      <h2 style="margin-bottom:10px">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡πà‡∏¢‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <div class="toolbar" style="margin-bottom:10px">
        <input id="search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô warfarin, ‡∏™‡∏π‡∏á" style="flex:1" />
        <button class="btn ghost" id="btnExport">Export JSON</button>
        <label class="btn ghost nowrap" for="fileImport">Import JSON</label>
        <input id="fileImport" type="file" accept="application/json" style="display:none" />
        <button class="btn ghost danger" id="btnClear">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>
      <div class="card" style="padding:0; overflow:auto; max-height:60vh;">
        <table>
          <thead>
            <tr>
              <th style="width:22%">‡∏¢‡∏≤ 1</th>
              <th style="width:22%">‡∏¢‡∏≤ 2</th>
              <th style="width:18%">‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
              <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
              <th class="nowrap" style="width:1%">‡∏•‡∏ö</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="muted" style="margin-top:8px">* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</div>
    </section>
  </div>

  <footer class="muted" style="margin-top:16px">
    <span class="mono">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</span> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£/‡∏£‡∏∞‡∏ö‡∏ö CPOE/‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á
  </footer>

  <script>
    const storeKey = 'drugInteractions_v2';
    const themeKey = 'drugTheme';
    const $ = (id) => document.getElementById(id);

    function normalizeDrug(name) { return name.trim().replace(/\s+/g, ' '); }
    function keyOf(a, b) {
      const A = normalizeDrug(a).toLowerCase();
      const B = normalizeDrug(b).toLowerCase();
      if (!A || !B) return '';
      return [A, B].sort().join(' | ');
    }

    function load() {
      try { return JSON.parse(localStorage.getItem(storeKey)) || null; } catch { return null; }
    }
    function save(map) { localStorage.setItem(storeKey, JSON.stringify(map)); }

    let db = load() || {
      [keyOf('Aspirin', 'Warfarin')]: { a: 'Aspirin', b: 'Warfarin', level: '‡∏™‡∏π‡∏á', notes: '‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å ‡πÄ‡∏û‡∏¥‡πà‡∏° INR' },
      [keyOf('Metformin', 'Alcohol')]: { a: 'Metformin', b: 'Alcohol', level: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', notes: '‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á Lactic acidosis' },
      [keyOf('Statin', 'Grapefruit')]: { a: 'Statin', b: 'Grapefruit', level: '‡∏™‡∏π‡∏á', notes: '‡∏¢‡∏±‡∏ö‡∏¢‡∏±‡πâ‡∏á CYP3A4 ‡πÄ‡∏û‡∏¥‡πà‡∏° CK/‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö' },
      [keyOf('Ibuprofen', 'Prednisolone')]: { a: 'Ibuprofen', b: 'Prednisolone', level: '‡∏ï‡πà‡∏≥', notes: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á GI irritation' },
    };

    function levelPill(level) {
      const lv = (level || '').toLowerCase();
      const cls = lv.includes('‡∏™‡∏π‡∏á') || lv.includes('high') ? 'high' :
                  (lv.includes('‡∏Å‡∏•‡∏≤‡∏á') || lv.includes('medium')) ? 'mid' : 'low';
      return `<span class="pill ${cls}">${level}</span>`;
    }

    function renderTable(filter = '') {
      const tbody = $('tbody');
      const q = filter.trim().toLowerCase();
      const rows = Object.values(db)
        .filter(it => {
          if (!q) return true;
          return (
            it.a.toLowerCase().includes(q) ||
            it.b.toLowerCase().includes(q) ||
            (it.level||'').toLowerCase().includes(q) ||
            (it.notes||'').toLowerCase().includes(q)
          );
        })
        .sort((x, y) => x.a.localeCompare(y.a) || x.b.localeCompare(y.b));

      tbody.innerHTML = rows.map(it => `
        <tr>
          <td>${escapeHtml(it.a)}</td>
          <td>${escapeHtml(it.b)}</td>
          <td>${levelPill(escapeHtml(it.level))}</td>
          <td>${escapeHtml(it.notes||'')}</td>
          <td><button class=\"btn ghost\" title=\"‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\" onclick=\"removePair('${keyOf(it.a, it.b)}')\">üóëÔ∏è</button></td>
        </tr>
      `).join('');

      const drugs = [...new Set(Object.values(db).flatMap(it => [it.a, it.b]))].sort();
      $('drugList').innerHTML = drugs.map(d => `<option value="${escapeHtml(d)}"></option>`).join('');
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>\"]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[m]));
    }

    function addOrUpdate() {
      const a = normalizeDrug($('drugA').value);
      const b = normalizeDrug($('drugB').value);
      const level = $('severity').value.trim();
      const notes = $('notes').value.trim();

      if (!a || !b) return Swal.fire('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á', 'warning');
      if (a.toLowerCase() === b.toLowerCase()) return Swal.fire('‡∏Ñ‡∏π‡πà‡∏¢‡∏≤‡∏ã‡πâ‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á', '‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏¢‡∏≤‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ï‡∏±‡∏ß', 'warning');

      const k = keyOf(a, b);
      const existed = !!db[k];
      db[k] = { a, b, level, notes };
      save(db);
      renderTable($('search').value);

      Swal.fire(existed ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `${a} + ${b} ‚Üí ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${level}`, existed ? 'info' : 'success');
      $('notes').value = '';
    }

    function checkPair() {
      const a = normalizeDrug($('drugA').value);
      const b = normalizeDrug($('drugB').value);
      if (!a || !b) return Swal.fire('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á', 'warning');
      const k = keyOf(a, b);
      const found = db[k];
      if (found) {
        Swal.fire('‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡∏¢‡∏≤', `${found.a} + ${found.b}<br>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: <b>${found.level}</b>${found.notes? '<br>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: '+escapeHtml(found.notes):''}`, 'error');
      } else {
        Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏ô‡∏µ‡πâ', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏π‡πà‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ', 'success');
      }
    }

    function removePair(k) {
      Swal.fire({
        title: '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?', text: '‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ', icon: 'warning', showCancelButton: true,
        confirmButtonText: '‡∏•‡∏ö', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then(res => {
        if (res.isConfirmed) {
          delete db[k];
          save(db); renderTable($('search').value);
          Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
        }
      });
    }

    function exportJson() {
      const blob = new Blob([JSON.stringify(db, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'drug_interactions.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    function importJson(file) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (Array.isArray(data)) {
            data.forEach(it => {
              if (it && it.a && it.b) db[keyOf(it.a, it.b)] = { a: it.a, b: it.b, level: it.level||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏', notes: it.notes||'' };
            });
          } else if (data && typeof data === 'object') {
            Object.values(data).forEach(it => {
              if (it && it.a && it.b) db[keyOf(it.a, it.b)] = { a: it.a, b: it.b, level: it.level||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏', notes: it.notes||'' };
            });
          } else throw new Error('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
          save(db); renderTable($('search').value);
          Swal.fire('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', '‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡πâ‡∏ß', 'success');
        } catch (e) {
          Swal.fire('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', e.message || '‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        }
      };
      reader.readAsText(file);
    }

    function clearAll() {
      Swal.fire({ title: '‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?', text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ', icon: 'warning', showCancelButton: true, confirmButtonText: '‡∏•‡πâ‡∏≤‡∏á', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' })
        .then(res => {
          if (res.isConfirmed) {
            db = {}; save(db); renderTable();
            Swal.fire('‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
          }
        });
    }

    // ‚Äî‚Äî Theme: toggle & persistence ‚Äî‚Äî
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    function applyTheme(theme) {
      const isLight = theme === 'light';
      document.documentElement.classList.toggle('light', isLight);
      const btn = $('btnTheme');
      btn.textContent = isLight ? '‚òÄÔ∏è ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á' : 'üåô ‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î';
      localStorage.setItem(themeKey, theme);
    }
    function initTheme() {
      const saved = localStorage.getItem(themeKey);
      applyTheme(saved ? saved : (prefersLight ? 'light' : 'dark'));
    }

    // ‚Äî‚Äî Event wiring ‚Äî‚Äî
    $('btnAdd').addEventListener('click', addOrUpdate);
    $('btnCheck').addEventListener('click', checkPair);
    $('btnExport').addEventListener('click', exportJson);
    $('fileImport').addEventListener('change', (e) => importJson(e.target.files[0]));
    $('btnClear').addEventListener('click', clearAll);
    $('search').addEventListener('input', (e) => renderTable(e.target.value));
    $('btnTheme').addEventListener('click', () => {
      const next = document.documentElement.classList.contains('light') ? 'dark' : 'light';
      applyTheme(next);
    });

    ['drugA','drugB','notes'].forEach(id => {
      $(id).addEventListener('keydown', (e) => { if (e.key === 'Enter') addOrUpdate(); });
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    initTheme();
    renderTable();
  </script>
</body>
</html>
